const bcrypt = require("bcrypt"); const pool = require("./src/db"); async function testLogin() { try { const username = "admin"; const password = "admin123"; console.log(`尝试查询用户: ${username}`); const [rows] = await pool.execute("SELECT * FROM users WHERE username = ?", [username]); if (rows.length === 0) { console.log("用户不存在"); return; } const user = rows[0]; console.log(`找到用户: ${user.username}, 密码哈希: ${user.password}`); console.log("测试bcrypt.compare函数..."); const match = await bcrypt.compare(password, user.password); console.log(`密码比对结果 (${password}): ${match}`); if (match) { console.log("认证成功!"); } else { console.log("认证失败! 测试更多密码..."); const testPasswords = ["123456", "admin", "password"]; for (const testPwd of testPasswords) { const testMatch = await bcrypt.compare(testPwd, user.password); console.log(`尝试密码 ${testPwd}: ${testMatch}`); } } } catch (error) { console.error("测试错误:", error); } finally { pool.end(); } } testLogin();
