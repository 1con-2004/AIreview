/* eslint-disable vue/multi-word-component-names */
<template>
  <div class="problems-page">
    <nav-bar></nav-bar>
    <div class="content">
      <!-- Â≠¶‰π†ËÆ°ÂàíÈÉ®ÂàÜ -->
      <div class="learning-plans">
        <div class="section-header">
          <h2>Â≠¶‰π†ËÆ°Âàí</h2>
          <router-link to="/learning-plans" class="view-more">Êü•ÁúãÊõ¥Â§ö</router-link>
        </div>
        <div class="plan-cards">
          <router-link
            v-for="(plan, index) in paginatedPlans"
            :key="index"
            :to="`/learning-plans/${plan.id}`"
            class="plan-card"
          >
            <div class="plan-icon">
              <img :src="plan.icon" :alt="plan.title">
            </div>
            <div class="plan-info">
              <h3>{{ plan.title }}</h3>
              <p>{{ plan.description }}</p>
              <div class="plan-creator" v-if="plan.creator_name">
                <span>ÂàõÂª∫ËÄÖ: {{ plan.creator_name }}</span>
              </div>
            </div>
          </router-link>
        </div>
        <div class="pagination">
          <button class="page-button" @click="prevPlanPage" :disabled="currentPlanPage === 1">
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <span class="page-info">Á¨¨ {{ currentPlanPage }} È°µÔºåÂÖ± {{ totalPlanPages }} È°µ</span>
          <button class="page-button" @click="nextPlanPage" :disabled="currentPlanPage >= totalPlanPages">
            <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- ÊêúÁ¥¢Êéß‰ª∂ÈÉ®ÂàÜ -->
      <div class="search-controls-wrapper">
        <div class="search-controls">
          <div class="difficulty-select-wrapper">
            <el-select
              v-model="selectedDifficulty"
              placeholder="ÈÄâÊã©ÈöæÂ∫¶"
              class="difficulty-select"
              popper-class="dark-select"
            >
              <el-option
                v-for="item in difficulties"
                :key="item.code"
                :label="item.name"
                :value="item.code"
              />
            </el-select>
          </div>
          <div class="status-select-wrapper">
            <el-select
              v-model="selectedStatus"
              placeholder="ÈÄâÊã©Áä∂ÊÄÅ"
              class="status-select"
            >
              <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
              <el-option label="Â∑≤ÈÄöËøá" value="Accepted"></el-option>
              <el-option label="Êú™ÈÄöËøá" value="Not Started"></el-option>
            </el-select>
          </div>
          <div class="search-box">
            <input
              type="text"
              v-model="searchQuery"
              placeholder="ÊêúÁ¥¢È¢òÁõÆ..."
            >
            <button
              v-if="/^\d+$/.test(searchQuery.trim())"
              class="exact-search-btn"
              :class="{ active: isExactSearch }"
              @click="toggleExactSearch"
            >
              Á≤æÁ°ÆÊêúÁ¥¢
            </button>
            <i class="search-icon"></i>
          </div>
          <button class="reset-button" @click="resetFilters">ÈáçÁΩÆ</button>
        </div>
      </div>

      <div class="main-content">
        <!-- Â∑¶‰æßÈ¢òÁõÆÂàóË°® -->
        <div class="problems-list">
          <div class="problem-cards">
            <router-link
              v-for="problem in paginatedProblems"
              :key="problem.id"
              :to="'/problems/detail/' + problem.problem_number"
              class="problem-card"
            >
              <div class="problem-number">{{ problem.problem_number }}</div>
              <div class="problem-info">
                <div class="problem-title">
                  {{ problem.title }}
                  <span v-if="problem.status === 'Accepted'" class="status-tag accepted">Â∑≤ÈÄöËøá</span>
                </div>
                <div class="problem-stats">
                  <span class="difficulty-tag" :class="problem.difficulty">{{ problem.difficulty }}</span>
                  <span class="submission-info">Êèê‰∫§: {{ problem.total_submissions }}</span>
                  <span class="rate-info">ÈÄöËøáÁéá: {{ problem.acceptance_rate }}%</span>
                </div>
                <div class="problem-tags">
                  <span v-for="tag in problem.tags" :key="tag" class="tag">{{ tag }}</span>
                </div>
              </div>
            </router-link>
          </div>

          <div class="pagination">
            <button class="page-button" @click="prevPage" :disabled="currentPage === 1">
              <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <span class="page-info">Á¨¨ {{ currentPage }} È°µÔºåÂÖ± {{ totalPages }} È°µ</span>
            <button class="page-button" @click="nextPage" :disabled="currentPage >= totalPages">
              <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Âè≥‰æßÂàÜÁ±ªÊ†è -->
        <div class="categories">
          <h3>È¢òÁõÆÂàÜÁ±ª</h3>

          <!-- Ê∑ªÂä†ÂàÜÁ±ªÊêúÁ¥¢Ê°Ü -->
          <div class="category-search">
            <input
              type="text"
              v-model="categorySearchQuery"
              placeholder="ÊêúÁ¥¢ÂàÜÁ±ª..."
              class="category-search-input"
            />
          </div>

          <!-- ÂàÜÁ±ªÂä†ËΩΩ‰∏≠Áä∂ÊÄÅ -->
          <div class="category-loading" v-if="loading.categories">
            <div class="loading-spinner"></div>
            <span>Ê≠£Âú®Âä†ËΩΩÂàÜÁ±ª...</span>
          </div>

          <!-- ‰∏ÄÁ∫ßÂàÜÁ±ªÂç°ÁâáÂàóË°® -->
          <div class="category-cards" v-else>
            <div
              v-for="category in filteredCategories"
              :key="category.id"
              class="parent-category-card"
              :class="{ 'active': expandedCategories[category.id] }"
              @click="toggleCategory(category.id)"
            >
              <div class="category-header">
                <div class="category-icon" :class="category.iconType || 'image'">
                  <template v-if="category.iconType === 'emoji'">
                    {{ category.emoji || 'üìö' }}
                  </template>
                  <img
                    v-else
                    :src="getCategoryIcon(category)"
                    :alt="category.name"
                    @error="handleIconError(category)"
                  />
                </div>
                <div class="category-title">{{ category.name }}</div>
                <div class="category-arrow" :class="{ 'expanded': expandedCategories[category.id] }">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>

              <!-- Â≠êÂàÜÁ±ªÂ±ïÂºÄÈÉ®ÂàÜ -->
              <div
                class="sub-categories"
                v-if="expandedCategories[category.id]"
                :class="{ 'expanded': expandedCategories[category.id] }"
              >
                <div
                  v-for="subCategory in category.children"
                  :key="subCategory.id"
                  class="sub-category-card"
                  :class="{ 'active': selectedCategories.includes(subCategory.id) }"
                  @click.stop="selectSubCategory(subCategory.id)"
                >
                  {{ subCategory.name }}
                  <span class="check-icon" v-if="selectedCategories.includes(subCategory.id)">‚úì</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Â¶ÇÊûúÊ†áÁ≠æËøòÈúÄË¶Å‰øùÁïôÊòæÁ§∫ÔºåÂèØ‰ª•Ê∑ªÂä†‰∏Ä‰∏™Ê†áÁ≠æÂå∫Âüü -->
          <div class="legacy-tags" v-if="false">
            <h4>Ê†áÁ≠æ</h4>
            <div class="tag-list">
              <button
                v-for="tag in paginatedTags"
                :key="tag"
                :class="['category-tag', { active: selectedTags.includes(tag) }]"
                @click="selectTag(tag)"
              >
                {{ tag }}
              </button>
            </div>
            <!-- Ê†áÁ≠æÂàÜÈ°µ -->
            <div class="tag-pagination">
              <button
                class="page-button"
                @click="prevTagPage"
                :disabled="tagCurrentPage === 1"
              >
                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <span class="page-info">{{ tagCurrentPage }} / {{ totalTagPages }}</span>
              <button
                class="page-button"
                @click="nextTagPage"
                :disabled="tagCurrentPage >= totalTagPages"
              >
                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import NavBar from '@/components/NavBar.vue'
import { ElSelect, ElOption } from 'element-plus'
import request from '@/utils/request'
import store from '@/store'

export default {
  name: 'ProblemsPage',
  components: {
    NavBar,
    ElSelect,
    ElOption
  },
  data () {
    return {
      problems: [],
      tags: [],
      selectedTags: [],
      searchQuery: '',
      currentPage: 1,
      itemsPerPage: 10,
      selectedDifficulty: '',
      difficulties: [
        { name: 'ÂÖ®ÈÉ®ÈöæÂ∫¶', code: '' },
        { name: 'ÁÆÄÂçï', code: 'ÁÆÄÂçï' },
        { name: '‰∏≠Á≠â', code: '‰∏≠Á≠â' },
        { name: 'Âõ∞Èöæ', code: 'Âõ∞Èöæ' }
      ],
      categorySearchQuery: '',
      tagSearchQuery: '',
      tagCurrentPage: 1,
      tagsPerPage: 10,
      plans: [],
      isExactSearch: false,
      selectedStatus: '',
      currentPlanPage: 1,
      plansPerPage: 6,
      loading: {
        problems: false,
        tags: false,
        categories: false
      },
      total: 0,
      categories: [],
      activeCategory: null,
      expandedCategories: {},
      selectedCategories: []
    }
  },
  computed: {
    totalPages () {
      return Math.ceil(this.filterProblems().length / this.itemsPerPage)
    },
    paginatedProblems () {
      const start = (this.currentPage - 1) * this.itemsPerPage
      return this.filterProblems().slice(start, start + this.itemsPerPage)
    },
    // ËøáÊª§ÂêéÁöÑÊ†áÁ≠æÂàóË°®
    filteredTags () {
      if (!this.categorySearchQuery) return this.tags
      const query = this.categorySearchQuery.toLowerCase()
      return this.tags.filter(tag =>
        tag.toLowerCase().includes(query)
      )
    },
    // Ê†áÁ≠æÊÄªÈ°µÊï∞
    totalTagPages () {
      return Math.ceil(this.filteredTags.length / this.tagsPerPage)
    },
    // ÂΩìÂâçÈ°µÁöÑÊ†áÁ≠æ
    paginatedTags () {
      const start = (this.tagCurrentPage - 1) * this.tagsPerPage
      return this.filteredTags.slice(start, start + this.tagsPerPage)
    },
    totalPlanPages () {
      return Math.ceil(this.plans.length / this.plansPerPage)
    },
    paginatedPlans () {
      const start = (this.currentPlanPage - 1) * this.plansPerPage
      return this.plans.slice(start, start + this.plansPerPage)
    },
    // ËøáÊª§ÂêéÁöÑÂàÜÁ±ªÂàóË°®
    filteredCategories () {
      if (!this.categorySearchQuery) return this.categories

      const query = this.categorySearchQuery.toLowerCase()
      return this.categories.map(category => {
        // Ê£ÄÊü•Áà∂ÂàÜÁ±ªÂêçÁß∞ÊòØÂê¶ÂåπÈÖç
        const isParentMatch = category.name.toLowerCase().includes(query)

        // ËøáÊª§ÂåπÈÖçÁöÑÂ≠êÂàÜÁ±ª
        const matchedChildren = category.children.filter(child =>
          child.name.toLowerCase().includes(query)
        )

        // Â¶ÇÊûúÁà∂ÂàÜÁ±ªÂåπÈÖçÊàñÊúâÂåπÈÖçÁöÑÂ≠êÂàÜÁ±ªÔºåÂàôËøîÂõûËøáÊª§ÂêéÁöÑÂàÜÁ±ª
        if (isParentMatch || matchedChildren.length > 0) {
          return {
            ...category,
            children: isParentMatch ? category.children : matchedChildren
          }
        }

        // Â¶ÇÊûúÊó¢‰∏çÂåπÈÖçÁà∂ÂàÜÁ±ª‰πüÊ≤°ÊúâÂåπÈÖçÁöÑÂ≠êÂàÜÁ±ªÔºåÂàôËøîÂõûnull
        return null
      }).filter(Boolean) // ËøáÊª§ÊéânullÂÄº
    }
  },
  async created () {
    // ÂàùÂßãÂåñÊó∂È¶ñÂÖàÊ£ÄÊü•Áî®Êà∑ÁôªÂΩïÁä∂ÊÄÅÊòØÂê¶‰∏ÄËá¥
    try {
      const userInfoStr = localStorage.getItem('userInfo')
      if (userInfoStr) {
        const userInfo = JSON.parse(userInfoStr)
        console.log('ProblemsÈ°µÈù¢ÂàùÂßãÂåñÔºåÂΩìÂâçÁî®Êà∑:', userInfo.username)

        // Áõ¥Êé•Â∞ÜÁî®Êà∑ÂêçÂ≠òÂÖ•sessionStorageÔºå‰∏çË∞ÉÁî®ÂèØËÉΩÂØºËá¥Áî®Êà∑ÂàáÊç¢ÁöÑÂÖ®Â±ÄÂáΩÊï∞
        sessionStorage.setItem('current_user', userInfo.username)
      }
    } catch (err) {
      console.error('ProblemsÈ°µÈù¢Ê£ÄÊü•Áî®Êà∑Áä∂ÊÄÅÂá∫Èîô:', err)
    }

    // Á°Æ‰øùÂàùÂßãÂåñÂÆåÊàêÂêéÂÜçËé∑ÂèñÊï∞ÊçÆ
    await this.$nextTick()
    await this.fetchPlans()
    await this.fetchCategories()
    this.fetchProblems()
    this.updateItemsPerPage()
    window.addEventListener('resize', this.updateItemsPerPage)
  },
  methods: {
    async fetchPlans () {
      try {
        console.log('ÂºÄÂßãËé∑ÂèñÂ≠¶‰π†ËÆ°Âàí...')
        const response = await request.get('/api/learning-plans')

        console.log('Â≠¶‰π†ËÆ°ÂàíÂìçÂ∫î:', response)

        if (response && Array.isArray(response)) {
          this.plans = response.map(plan => ({
            id: plan.id,
            title: plan.title || '',
            description: plan.description || '',
            icon: plan.icon
              ? this.getCorrectIconPath(plan.icon)
              : '/icons/default.png',
            creator_name: plan.creator_name || ''
          }))
          console.log('Â§ÑÁêÜÂêéÁöÑÂ≠¶‰π†ËÆ°Âàí:', this.plans)
        } else {
          console.log('Â≠¶‰π†ËÆ°ÂàíÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ:', response)
          this.plans = []
        }
      } catch (error) {
        console.error('Ëé∑ÂèñÂ≠¶‰π†ËÆ°ÂàíÂ§±Ë¥•:', error)
        if (error.response?.status === 401) {
          this.$message.error('Ëé∑ÂèñÂ≠¶‰π†ËÆ°ÂàíÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï')
        } else {
          this.$message.error('Ëé∑ÂèñÂ≠¶‰π†ËÆ°ÂàíÂ§±Ë¥•: ' + (error.message || 'ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï'))
        }
        this.plans = []
      }
    },
    getCorrectIconPath (iconPath) {
      // Â¶ÇÊûúÊòØÂÆåÊï¥URLË∑ØÂæÑÔºåÁõ¥Êé•ËøîÂõû
      if (iconPath.startsWith('http')) {
        return iconPath
      }

      // Â§ÑÁêÜiconsË∑ØÂæÑ
      if (iconPath.includes('/icons/')) {
        // Á°Æ‰øùË∑ØÂæÑ‰∏ç‰ª•Â§ö‰∏™ÊñúÊù†ÂºÄÂ§¥
        return iconPath.startsWith('/') ? iconPath : `/${iconPath}`
      }

      // Â§ÑÁêÜpublic/iconsË∑ØÂæÑ
      if (iconPath.includes('public/icons/')) {
        const fileName = iconPath.split('/').pop()
        return `/icons/${fileName}`
      }

      // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
      console.log('Â§ÑÁêÜÂ≠¶‰π†Ë∑ØÂæÑÂõæÊ†áÔºåÂéüÂßãË∑ØÂæÑ:', iconPath)

      // ÈªòËÆ§ËøîÂõûÂéüË∑ØÂæÑÔºåÁ°Æ‰øù‰ª•/ÂºÄÂ§¥
      return iconPath.startsWith('/') ? iconPath : `/${iconPath}`
    },
    async fetchCategories () {
      try {
        this.loading.categories = true
        const token = store.getters.getAccessToken

        // ‰ΩøÁî®Êñ∞ÁöÑAPIÁ´ØÁÇπËé∑ÂèñÂàÜÁ±ªÊï∞ÊçÆ
        const response = await request.get('/api/problems/all-categories', {
          headers: {
            Authorization: `Bearer ${token}`
          }
        })

        console.log('Ëé∑ÂèñÂà∞ÁöÑÂàÜÁ±ªÊï∞ÊçÆ:', response)

        if (response && (response.data || response.code === 200)) {
          // Â§ÑÁêÜÂàÜÁ±ªÊï∞ÊçÆ
          const categories = response.data?.categories || response.data || []
          const parentCategories = []
          const childrenMap = {}

          // ÊåâÁ∫ßÂà´ÂàÜÁªÑ
          categories.forEach(category => {
            if (category.level === 1) {
              parentCategories.push({
                id: category.id,
                name: category.name,
                description: category.description || '',
                slug: category.slug || '',
                icon: category.icon || 'default',
                // ‰∏∫ÊØè‰∏™‰∏ÄÁ∫ßÂàÜÁ±ªËÆæÁΩÆ‰∏çÂêåÁöÑemoji
                iconType: 'emoji',
                emoji: this.getCategoryEmoji(category.slug || category.name),
                children: []
              })
            } else if (category.level === 2 && category.parent_id) {
              if (!childrenMap[category.parent_id]) {
                childrenMap[category.parent_id] = []
              }
              childrenMap[category.parent_id].push({
                id: category.id,
                name: category.name,
                description: category.description || '',
                parentId: category.parent_id,
                slug: category.slug || ''
              })
            }
          })

          // Â∞ÜÂ≠êÂàÜÁ±ªÊ∑ªÂä†Âà∞Áà∂ÂàÜÁ±ª‰∏≠
          parentCategories.forEach(parent => {
            if (childrenMap[parent.id]) {
              parent.children = childrenMap[parent.id]
            }
          })

          this.categories = parentCategories
          console.log('Â§ÑÁêÜÂêéÁöÑÂàÜÁ±ªÊï∞ÊçÆ:', this.categories)
        } else {
          // Â¶ÇÊûúAPIËøîÂõûÊ†ºÂºè‰∏çÂØπÔºå‰ΩøÁî®Â§áÁî®Êï∞ÊçÆ
          console.error('APIËøîÂõûÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºå‰ΩøÁî®Â§áÁî®Êï∞ÊçÆ')
          this.useFallbackCategories()
        }
      } catch (error) {
        console.error('Ëé∑ÂèñÂàÜÁ±ªÂ§±Ë¥•:', error)
        if (error.response?.status === 401) {
          await store.dispatch('logout')
          this.$router.push('/login')
          this.$message.error('ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï')
        } else {
          console.error('‰ΩøÁî®Â§áÁî®Êï∞ÊçÆ:', error.message)
          this.useFallbackCategories()
        }
      } finally {
        this.loading.categories = false
      }
    },
    // Ê†πÊçÆÂàÜÁ±ªÂêçÁß∞ÊàñslugËé∑ÂèñÂØπÂ∫îÁöÑemoji
    getCategoryEmoji (category) {
      // ÂàÜÁ±ªemojiÊò†Â∞Ñ
      const emojiMap = {
        'data-structure': 'üìä',
        algorithm: 'üß©',
        math: 'üî¢',
        basic: 'üíª',
        array: 'üìã',
        string: 'üî§',
        tree: 'üå≥',
        'linked-list': 'üîó',
        'hash-table': 'üîç',
        'dynamic-programming': 'üìà',
        greedy: 'üèéÔ∏è',
        backtracking: 'üîÑ',
        sorting: 'üìä',
        recursion: 'üîÅ',
        queue: 'üì¶',
        stack: 'üìö'
      }

      // ËΩ¨Êç¢ÂàÜÁ±ªÂêç‰∏∫Â∞èÂÜôÔºå‰Ωú‰∏∫keyÊü•Êâæ
      const key = category.toLowerCase().replace(/\s+/g, '-')

      // ËøîÂõûÊâæÂà∞ÁöÑemojiÊàñÈªòËÆ§emoji
      return emojiMap[key] || 'üìò'
    },
    // ‰ΩøÁî®Â§áÁî®ÂàÜÁ±ªÊï∞ÊçÆ
    useFallbackCategories () {
      const fallbackCategories = [
        {
          id: 1,
          name: 'Êï∞ÊçÆÁªìÊûÑ',
          description: '‰∏éÊï∞ÊçÆÁªìÊûÑÁõ∏ÂÖ≥ÁöÑÁÆóÊ≥ïÈ¢ò',
          slug: 'data-structure',
          icon: 'structure',
          iconType: 'emoji',
          emoji: 'üìä',
          children: [
            { id: 101, name: 'Êï∞ÁªÑ', description: 'Êï∞ÁªÑÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'array' },
            { id: 102, name: 'ÈìæË°®', description: 'ÈìæË°®Áõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'linked-list' },
            { id: 103, name: 'Ê†ë', description: 'Ê†ëÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'tree' },
            { id: 104, name: 'Ê†à', description: 'Ê†àÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'stack' },
            { id: 105, name: 'ÈòüÂàó', description: 'ÈòüÂàóÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'queue' },
            { id: 106, name: 'ÂìàÂ∏åË°®', description: 'ÂìàÂ∏åË°®Áõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 1, slug: 'hash-table' }
          ]
        },
        {
          id: 2,
          name: 'ÁÆóÊ≥ïÊäÄÂ∑ß',
          description: 'Â∏∏ËßÅÁÆóÊ≥ïÊäÄÂ∑ß‰∏éÊÄùÊÉ≥',
          slug: 'algorithm',
          icon: 'algorithm',
          iconType: 'emoji',
          emoji: 'üß©',
          children: [
            { id: 201, name: 'Âä®ÊÄÅËßÑÂàí', description: 'Âä®ÊÄÅËßÑÂàíÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 2, slug: 'dynamic-programming' },
            { id: 202, name: 'Ë¥™ÂøÉÁÆóÊ≥ï', description: 'Ë¥™ÂøÉÁÆóÊ≥ïÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 2, slug: 'greedy' },
            { id: 203, name: 'ÂõûÊ∫ØÁÆóÊ≥ï', description: 'ÂõûÊ∫ØÁÆóÊ≥ïÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 2, slug: 'backtracking' },
            { id: 204, name: 'ÂàÜÊ≤ªÁÆóÊ≥ï', description: 'ÂàÜÊ≤ªÁÆóÊ≥ïÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 2, slug: 'divide-and-conquer' },
            { id: 205, name: 'ÊéíÂ∫èÁÆóÊ≥ï', description: 'ÊéíÂ∫èÁÆóÊ≥ïÁõ∏ÂÖ≥ÁöÑÈ¢òÁõÆ', parentId: 2, slug: 'sorting' }
          ]
        },
        {
          id: 3,
          name: 'Êï∞Â≠¶',
          description: 'Êï∞Â≠¶Áõ∏ÂÖ≥ÁöÑÈóÆÈ¢ò',
          slug: 'math',
          icon: 'calculator',
          iconType: 'emoji',
          emoji: 'üî¢',
          children: [
            { id: 301, name: 'Âü∫Á°ÄÊï∞Â≠¶', description: 'Âü∫Á°ÄÊï∞Â≠¶È¢òÁõÆ', parentId: 3, slug: 'basic-math' },
            { id: 302, name: 'Ê¶ÇÁéáÁªüËÆ°', description: 'Ê¶ÇÁéáÁªüËÆ°Áõ∏ÂÖ≥È¢òÁõÆ', parentId: 3, slug: 'probability' },
            { id: 303, name: 'Á∫øÊÄß‰ª£Êï∞', description: 'Á∫øÊÄß‰ª£Êï∞Áõ∏ÂÖ≥È¢òÁõÆ', parentId: 3, slug: 'linear-algebra' },
            { id: 304, name: 'Êï∞ËÆ∫', description: 'Êï∞ËÆ∫Áõ∏ÂÖ≥È¢òÁõÆ', parentId: 3, slug: 'number-theory' }
          ]
        },
        {
          id: 4,
          name: 'Âü∫Á°ÄÁºñÁ®ã',
          description: 'Âü∫Á°ÄÁºñÁ®ãËÉΩÂäõËÄÉÂØü',
          slug: 'basic',
          icon: 'code',
          iconType: 'emoji',
          emoji: 'üíª',
          children: [
            { id: 401, name: 'Â≠óÁ¨¶‰∏≤Â§ÑÁêÜ', description: 'Â≠óÁ¨¶‰∏≤Â§ÑÁêÜÁõ∏ÂÖ≥È¢òÁõÆ', parentId: 4, slug: 'string' },
            { id: 402, name: '‰ΩçËøêÁÆó', description: '‰ΩçËøêÁÆóÁõ∏ÂÖ≥È¢òÁõÆ', parentId: 4, slug: 'bit-manipulation' },
            { id: 403, name: 'Ê®°Êãü', description: 'Ê®°ÊãüÂÆûÁé∞Áõ∏ÂÖ≥È¢òÁõÆ', parentId: 4, slug: 'simulation' },
            { id: 404, name: 'Ê≠£ÂàôË°®ËææÂºè', description: 'Ê≠£ÂàôË°®ËææÂºèÁõ∏ÂÖ≥È¢òÁõÆ', parentId: 4, slug: 'regex' }
          ]
        }
      ]

      this.categories = fallbackCategories
      console.log('‰ΩøÁî®Â§áÁî®ÂàÜÁ±ªÊï∞ÊçÆ:', this.categories)
    },
    async fetchProblems () {
      try {
        this.loading.problems = true
        const token = store.getters.getAccessToken
        const params = {
          page: this.currentPage,
          limit: this.itemsPerPage,
          search: this.searchQuery,
          difficulty: this.selectedDifficulty,
          status: this.selectedStatus,
          tags: this.selectedTags
        }

        const response = await request.get('/api/problems', {
          params,
          headers: {
            Authorization: `Bearer ${token}`
          }
        })
        console.log('Ëé∑ÂèñÂà∞ÁöÑÈ¢òÁõÆÊï∞ÊçÆ:', response)

        if (response && response.data) {
          this.problems = response.data.map(problem => ({
            id: problem.id,
            problem_number: problem.problem_number || '',
            title: problem.title || '',
            difficulty: problem.difficulty || 'ÁÆÄÂçï',
            tags: typeof problem.tags === 'string' ? problem.tags.split(',').map(tag => tag.trim()) : [],
            total_submissions: parseInt(problem.total_submissions) || 0,
            acceptance_rate: parseFloat(problem.acceptance_rate) || 0,
            status: problem.status || 'Not Started',
            description: problem.description || ''
          }))
          this.total = response.total || this.problems.length
          console.log('Â§ÑÁêÜÂêéÁöÑÈ¢òÁõÆÂàóË°®:', this.problems)

          // Ëé∑ÂèñÁî®Êà∑È¢òÁõÆÂÆåÊàêÁä∂ÊÄÅ
          await this.fetchUserProblemStatus()

          // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØÔºöÊ£ÄÊü•È¢òÁõÆÁä∂ÊÄÅ
          console.log('Ëé∑ÂèñÂÆåÁî®Êà∑Áä∂ÊÄÅÂêéÁöÑÈ¢òÁõÆÂàóË°®:', this.problems.filter(p => p.status === 'Accepted').map(p => ({
            id: p.id,
            title: p.title,
            status: p.status
          })))
        } else {
          throw new Error('Ëé∑ÂèñÈ¢òÁõÆÂàóË°®Â§±Ë¥•')
        }
      } catch (error) {
        console.error('Ëé∑ÂèñÈóÆÈ¢òÂàóË°®Â§±Ë¥•:', error)
        if (error.response?.status === 401) {
          await store.dispatch('logout')
          this.$router.push('/login')
          this.$message.error('ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï')
        } else {
          this.$message.error('Ëé∑ÂèñÈóÆÈ¢òÂàóË°®Â§±Ë¥•: ' + (error.message || 'ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï'))
          this.problems = []
          this.total = 0
        }
      } finally {
        this.loading.problems = false
      }
    },
    // Ëé∑ÂèñÁî®Êà∑È¢òÁõÆÂÆåÊàêÁä∂ÊÄÅ
    async fetchUserProblemStatus () {
      try {
        const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}')
        const token = userInfo.token || store.getters.getAccessToken
        if (!token) {
          console.log('Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËøáËé∑ÂèñÈ¢òÁõÆÁä∂ÊÄÅ')
          return
        }

        // ÊèêÂèñÊâÄÊúâÈ¢òÁõÆID - Á°Æ‰øùÈÉΩÊòØÊúâÊïàÊï∞Â≠ó
        const problemIds = this.problems
          .map(p => p.id)
          .filter(id => !isNaN(id) && id !== null && id !== undefined)

        if (problemIds.length === 0) {
          console.log('Ê≤°ÊúâÊúâÊïàÁöÑÈ¢òÁõÆIDÔºåË∑≥ËøáËé∑ÂèñÁä∂ÊÄÅ')
          return
        }

        console.log('Ëé∑ÂèñÈ¢òÁõÆÁä∂ÊÄÅÔºåÈ¢òÁõÆIDs:', problemIds)

        // Ëé∑ÂèñÁî®Êà∑Êèê‰∫§Áä∂ÊÄÅ
        const headers = { Authorization: `Bearer ${token}` }
        try {
          // Ê≥®ÊÑèËøôÈáå‰ΩøÁî®ÊòéÁ°ÆÁöÑÂÆåÊï¥APIË∑ØÂæÑÔºåÈÅøÂÖçË∑ØÁî±Ê∑∑Ê∑Ü
          console.log('ËØ∑Ê±ÇAPIË∑ØÂæÑÔºö/api/problems/user-status')
          const response = await request.get('/api/problems/user-status', {
            params: { problem_ids: problemIds.join(',') },
            headers
          })

          console.log('Ëé∑ÂèñÂà∞ÁöÑÁî®Êà∑È¢òÁõÆÁä∂ÊÄÅ:', response)

          if (response && response.success && Array.isArray(response.data)) {
            // ÂàõÂª∫È¢òÁõÆIDÂà∞Áä∂ÊÄÅÁöÑÊò†Â∞Ñ
            const statusMap = {}
            response.data.forEach(item => {
              if (item && item.problem_id && item.status) {
                statusMap[item.problem_id] = item.status
              }
            })

            // Êõ¥Êñ∞È¢òÁõÆÂÆåÊàêÁä∂ÊÄÅ
            if (Object.keys(statusMap).length > 0) {
              this.problems = this.problems.map(problem => ({
                ...problem,
                status: statusMap[problem.id] || problem.status || 'Not Started'
              }))

              console.log('Êõ¥Êñ∞ÂêéÁöÑÈ¢òÁõÆÁä∂ÊÄÅ:', this.problems.filter(p => p.status === 'Accepted').map(p => ({
                id: p.id,
                title: p.title,
                status: p.status
              })))
            } else {
              console.log('Ê≤°ÊúâËé∑ÂèñÂà∞‰ªª‰ΩïÈ¢òÁõÆÁä∂ÊÄÅÊï∞ÊçÆ')
            }
          } else {
            console.log('APIÂìçÂ∫îÊ†ºÂºè‰∏çÊ≠£Á°ÆÊàñÊ≤°ÊúâÊï∞ÊçÆ:', response)
          }
        } catch (apiError) {
          console.error('APIËØ∑Ê±ÇÂ§±Ë¥•:', apiError)
          // Â∞ùËØïÂ§áÈÄâÊñπÊ°àÔºöÁõ¥Êé•Ëé∑ÂèñÁî®Êà∑ÊâÄÊúâÈ¢òÁõÆÁä∂ÊÄÅ
          try {
            console.log('Â∞ùËØïÂ§áÈÄâÊñπÊ°àËé∑ÂèñÁî®Êà∑È¢òÁõÆÁä∂ÊÄÅÔºåËØ∑Ê±ÇË∑ØÂæÑ: /api/user/problem-status')
            const acceptedResponse = await request.get('/api/user/problem-status', { headers })

            if (acceptedResponse && acceptedResponse.success && Array.isArray(acceptedResponse.data)) {
              const statusMap = {}
              acceptedResponse.data.forEach(item => {
                if (item && item.problem_id) {
                  statusMap[item.problem_id] = item.status
                }
              })

              if (Object.keys(statusMap).length > 0) {
                this.problems = this.problems.map(problem => ({
                  ...problem,
                  status: statusMap[problem.id] || problem.status || 'Not Started'
                }))

                console.log('Â§áÈÄâÊñπÊ°àÊõ¥Êñ∞ÂêéÁöÑÈ¢òÁõÆÁä∂ÊÄÅ:',
                  this.problems.filter(p => p.status === 'Accepted').length, 'ÈÅìÂ∑≤ÈÄöËøá')
              }
            }
          } catch (fallbackError) {
            console.error('Â§áÈÄâÊñπÊ°àËé∑ÂèñÁî®Êà∑È¢òÁõÆÁä∂ÊÄÅÂ§±Ë¥•:', fallbackError)
          }
        }
      } catch (error) {
        console.error('Ëé∑ÂèñÁî®Êà∑È¢òÁõÆÁä∂ÊÄÅÂ§±Ë¥•:', error)
        // ÈîôËØØÊó∂‰∏çÊõ¥Êñ∞È¢òÁõÆÁä∂ÊÄÅÔºå‰øùÊåÅÂéüÁä∂ÊÄÅ
      }
    },
    filterProblems () {
      let filteredProblems = this.problems

      // ‰ΩøÁî®Êñ∞ÁöÑÂàÜÁ±ªËøáÊª§ÈÄªËæë
      if (this.selectedCategories.length > 0) {
        filteredProblems = filteredProblems.filter(problem => {
          // ‰øÆÊîπ‰∏∫"‰∏é"Êìç‰ΩúÔºåÁ°Æ‰øùÈóÆÈ¢òÂåÖÂê´ÊâÄÊúâÂ∑≤ÈÄâÂàÜÁ±ª
          return this.selectedCategories.every(categoryId => {
            // Âú®ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÈóÆÈ¢òÁöÑÊ†áÁ≠æÂíåÂàÜÁ±ªIDËøõË°åÂåπÈÖç
            const category = this.categories.flatMap(c => c.children).find(c => c.id === categoryId)
            return category && problem.tags.includes(category.name)
          })
        })
      } else if (this.selectedTags.length > 0) {
        // ‰øùÁïôÂéüÊúâÁöÑÊ†áÁ≠æËøáÊª§ÈÄªËæë‰Ωú‰∏∫Â§áÁî®
        filteredProblems = filteredProblems.filter(problem => {
          return this.selectedTags.every(tag => problem.tags.includes(tag))
        })
      }

      if (this.searchQuery) {
        const query = this.searchQuery.toLowerCase()

        if (/^\d+$/.test(query) && this.isExactSearch) {
          filteredProblems = filteredProblems.filter(problem =>
            problem.id.toString() === query
          )
        } else {
          filteredProblems = filteredProblems.filter(problem => {
            return (
              problem.id.toString().includes(query) ||
              problem.title.toLowerCase().includes(query)
            )
          })
        }
      }

      if (this.selectedDifficulty) {
        filteredProblems = filteredProblems.filter(problem =>
          problem.difficulty === this.selectedDifficulty
        )
      }

      if (this.selectedStatus) {
        // Áä∂ÊÄÅÁ≠õÈÄâ
        console.log('Á≠õÈÄâÁä∂ÊÄÅ:', this.selectedStatus)
        console.log('Á≠õÈÄâÂâçÈ¢òÁõÆÊï∞:', filteredProblems.length)

        filteredProblems = filteredProblems.filter(problem => {
          const result = problem.status === this.selectedStatus
          return result
        })

        console.log('Á≠õÈÄâÂêéÈ¢òÁõÆÊï∞:', filteredProblems.length)
      }

      return filteredProblems
    },
    selectTag (tag) {
      if (this.selectedTags.includes(tag)) {
        this.selectedTags = this.selectedTags.filter(t => t !== tag)
      } else {
        this.selectedTags.push(tag)
      }
      this.currentPage = 1
    },
    resetFilters () {
      this.selectedTags = []
      this.selectedCategories = []
      this.selectedDifficulty = ''
      this.searchQuery = ''
      this.currentPage = 1
      this.expandedCategories = {}
      this.activeCategory = null
    },
    nextPage () {
      if (this.currentPage < this.totalPages) {
        this.currentPage++
      }
    },
    prevPage () {
      if (this.currentPage > 1) {
        this.currentPage--
      }
    },
    updateItemsPerPage () {
      const width = window.innerWidth
      if (width < 2000) {
        this.itemsPerPage = 10
      } else if (width < 3000) {
        this.itemsPerPage = 15
      } else {
        this.itemsPerPage = 20
      }
      this.currentPage = 1
    },
    // Ê†áÁ≠æÂàÜÈ°µÊñπÊ≥ï
    prevTagPage () {
      if (this.tagCurrentPage > 1) {
        this.tagCurrentPage--
      }
    },
    nextTagPage () {
      if (this.tagCurrentPage < this.totalTagPages) {
        this.tagCurrentPage++
      }
    },
    toggleExactSearch () {
      this.isExactSearch = !this.isExactSearch
      this.currentPage = 1
    },
    nextPlanPage () {
      if (this.currentPlanPage < this.totalPlanPages) {
        this.currentPlanPage++
      }
    },
    prevPlanPage () {
      if (this.currentPlanPage > 1) {
        this.currentPlanPage--
      }
    },
    toggleCategory (categoryId) {
      // ‰ΩøÁî®VueÁöÑÂìçÂ∫îÂºèÂØπË±°Êõ¥Êñ∞ÊñπÂºè
      const newExpandedCategories = { ...this.expandedCategories }
      newExpandedCategories[categoryId] = !newExpandedCategories[categoryId]
      this.expandedCategories = newExpandedCategories

      // Â¶ÇÊûúÂ±ïÂºÄ‰∫ÜÂàÜÁ±ªÔºåÂàôËÆæÁΩÆ‰∏∫Ê¥ªË∑ÉÂàÜÁ±ª
      if (this.expandedCategories[categoryId]) {
        this.activeCategory = categoryId
      } else if (this.activeCategory === categoryId) {
        this.activeCategory = null
      }
    },
    selectSubCategory (categoryId) {
      const index = this.selectedCategories.indexOf(categoryId)
      if (index > -1) {
        // Â¶ÇÊûúÂ∑≤ÈÄâ‰∏≠ÔºåÂàôÁßªÈô§
        this.selectedCategories.splice(index, 1)
      } else {
        // Âê¶ÂàôÊ∑ªÂä†
        this.selectedCategories.push(categoryId)
      }
      // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
      this.currentPage = 1
    },
    getCategoryIcon (category) {
      // ÂõæÊ†áÊò†Â∞ÑË°®
      const iconMap = {
        structure: '/imgs/categories/data-structure.png',
        algorithm: '/imgs/categories/algorithm.png',
        calculator: '/imgs/categories/math.png',
        code: '/imgs/categories/code.png',
        default: '/imgs/categories/default.png'
      }

      if (category.icon) {
        // Â¶ÇÊûúÊòØÂÆåÊï¥URLË∑ØÂæÑÔºåÁõ¥Êé•‰ΩøÁî®
        if (category.icon.startsWith('http')) {
          return category.icon
        }

        // Â¶ÇÊûúÊòØÂ∑≤Áü•ÂõæÊ†áÔºå‰ΩøÁî®Êò†Â∞Ñ
        if (iconMap[category.icon]) {
          return iconMap[category.icon]
        }

        // Â∞ùËØï‰ªé/icons/Ë∑ØÂæÑËé∑Âèñ
        return `/icons/${category.icon}.svg`
      }

      // ÈªòËÆ§ÂõæÊ†á
      return '/imgs/categories/default.png'
    },
    // Â§ÑÁêÜÂõæÊ†áÂä†ËΩΩÈîôËØØ
    handleIconError (category) {
      console.log('ÂõæÊ†áÂä†ËΩΩÂ§±Ë¥•:', category.name)
      // ËÆæÁΩÆ‰∏∫‰ΩøÁî®emojiÁ±ªÂûã
      category.iconType = 'emoji'
      category.emoji = 'üìö' // ÈªòËÆ§‰ΩøÁî®‰π¶Á±çemoji
    },
    async handlePageChange (page) {
      // ... existing code ...
    }
  },
  beforeUnmount () {
    window.removeEventListener('resize', this.updateItemsPerPage)
  },
  watch: {
    // ÁõëÂê¨ÊêúÁ¥¢Êù°‰ª∂ÂèòÂåñ
    searchQuery (newVal) {
      if (!/^\d+$/.test(newVal.trim())) {
        this.isExactSearch = false
      }
      this.currentPage = 1
    },
    // ÁõëÂê¨ÈöæÂ∫¶ÈÄâÊã©ÂèòÂåñ
    selectedDifficulty () {
      this.currentPage = 1
    },
    // ÁõëÂê¨Ê†áÁ≠æÈÄâÊã©ÂèòÂåñ
    selectedTags: {
      handler () {
        this.currentPage = 1
      },
      deep: true
    },
    // ÁõëÂê¨ÂàÜÁ±ªÊêúÁ¥¢ÔºåÈáçÁΩÆÂ±ïÂºÄÁä∂ÊÄÅ
    categorySearchQuery () {
      // Â∞ÜÂàÜÁ±ªÊêúÁ¥¢ÂêåÊ≠•Âà∞Ê†áÁ≠æÊêúÁ¥¢‰ª•‰øùÊåÅÂÖºÂÆπÊÄß
      this.tagSearchQuery = this.categorySearchQuery
      this.tagCurrentPage = 1

      // Â¶ÇÊûúÊúâÊêúÁ¥¢ËØçÔºåËá™Âä®Â±ïÂºÄÊâÄÊúâÂàÜÁ±ª
      if (this.categorySearchQuery) {
        const newExpandedCategories = {}
        this.filteredCategories.forEach(category => {
          newExpandedCategories[category.id] = true
        })
        this.expandedCategories = newExpandedCategories
      } else {
        // Â¶ÇÊûúÊ∏ÖÁ©∫ÊêúÁ¥¢ËØçÔºåÊäòÂè†ÊâÄÊúâÂàÜÁ±ª
        this.expandedCategories = {}
        this.activeCategory = null
      }
    },
    // ÂèçÂêëÂêåÊ≠•Ê†áÁ≠æÊêúÁ¥¢ÂíåÂàÜÁ±ªÊêúÁ¥¢
    tagSearchQuery () {
      if (this.categorySearchQuery !== this.tagSearchQuery) {
        this.categorySearchQuery = this.tagSearchQuery
      }
    },
    selectedStatus () {
      this.currentPage = 1
    }
  }
}
</script>

<style scoped>
.problems-page {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: #0d1117;
  color: white;
}

.content {
  padding: 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* Â≠¶‰π†ËÆ°ÂàíÊ†∑Âºè */
.learning-plans {
  padding: 20px;
  margin: 0;
  background-color: #1e1e2d;
  border-radius: 8px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h2 {
  font-size: 20px;
  color: #fff;
  margin: 0;
}

.view-more {
  color: #4ecdc4;
  text-decoration: none;
  font-size: 14px;
  transition: color 0.3s ease;
}

.view-more:hover {
  color: #5fede4;
}

.plan-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* ‰øÆÊîπ‰∏∫Âõ∫ÂÆö3ÂàóÂ∏ÉÂ±Ä */
  gap: 20px;
}

.plan-card {
  display: flex;
  align-items: center;
  padding: 20px;
  background: #282836;
  border-radius: 12px;
  transition: all 0.3s ease;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.plan-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  border-color: #4ecdc4;
  background: #2f2f40;
}

.plan-icon {
  width: 60px;
  height: 60px;
  margin-right: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.plan-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.plan-info {
  flex: 1;
}

.plan-info h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #fff;
}

.plan-info p {
  margin: 0;
  font-size: 14px;
  color: #a6accd;
  line-height: 1.4;
}

.plan-creator {
  margin-top: 8px;
  font-size: 12px;
  color: #6a7a8c;
  display: flex;
  align-items: center;
}

.plan-creator span {
  background-color: rgba(78, 205, 196, 0.1);
  padding: 2px 8px;
  border-radius: 4px;
  color: #4ecdc4;
}

/* ÂìçÂ∫îÂºèÂ∏ÉÂ±Ä */
@media (max-width: 1200px) {
  .plan-cards {
    grid-template-columns: repeat(2, 1fr); /* ‰∏≠Á≠âÂ±èÂπïÊòæÁ§∫2Âàó */
  }
}

@media (max-width: 768px) {
  .plan-cards {
    grid-template-columns: 1fr; /* Â∞èÂ±èÂπïÊòæÁ§∫1Âàó */
  }

  .plan-card {
    padding: 15px;
  }

  .plan-icon {
    width: 50px;
    height: 50px;
  }
}

/* Êñ∞ÁöÑÊêúÁ¥¢Êéß‰ª∂Ê†∑Âºè */
.search-controls-wrapper {
  margin: 0;
  padding: 0 20px;
  margin-bottom: -10px;
}

.search-controls {
  display: flex;
  gap: 16px;
  align-items: center;
  background: #282836;
  padding: 16px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.difficulty-select-wrapper {
  min-width: 120px;
}

.difficulty-select {
  width: 120px;
}

.status-select-wrapper {
  min-width: 120px;
}

.search-box {
  position: relative;
  flex: 1;
  max-width: 400px;
}

.search-box input {
  width: 100%;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: #2d2d3f;
  color: white;
  font-size: 14px;
  padding-right: 100px; /* ‰∏∫Á≤æÁ°ÆÊêúÁ¥¢ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
}

.exact-search-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: #2d2d3f;
  color: #a6accd;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.exact-search-btn.active {
  background: #4ecdc4;
  color: white;
  border-color: #4ecdc4;
}

.exact-search-btn:hover {
  background: #4ecdc4;
  color: white;
  border-color: #4ecdc4;
}

.reset-button {
  padding: 8px 16px;
  border-radius: 6px;
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #a6accd;
  cursor: pointer;
  transition: all 0.3s ease;
}

.reset-button:hover {
  border-color: #4ecdc4;
  color: #fff;
}

/* ÂìçÂ∫îÂºèÂ∏ÉÂ±ÄË∞ÉÊï¥ */
@media (max-width: 768px) {
  .search-controls {
    flex-direction: column;
    gap: 12px;
  }

  .difficulty-select-wrapper {
    width: 100%;
  }

  .search-box {
    width: 100%;
  }

  .reset-button {
    width: 100%;
  }
}

/* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ÂüüÊ†∑Âºè */
.main-content {
  display: flex;
  gap: 40px;
  margin-top: 10px;
}

.problems-list {
  flex: 3;
}

.problem-cards {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.problem-card {
  background-color: #1e1e2e;
  border-radius: 12px;
  padding: 20px;
  display: flex;
  gap: 20px;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

.problem-card:hover {
  transform: translateX(8px);
  border-color: rgba(255, 255, 255, 0.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.problem-number {
  font-size: 24px;
  font-weight: bold;
  color: #a6accd;
  min-width: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.problem-info {
  flex: 1;
}

.problem-title {
  display: flex;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #e6edf3;
  margin-bottom: 8px;
}

.problem-card:hover .problem-title {
  color: #4ecdc4;
}

.problem-stats {
  margin-top: 8px;
  display: flex;
  gap: 16px;
  color: #a6accd;
  font-size: 14px;
}

.difficulty-tag {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.difficulty-tag.ÁÆÄÂçï {
  background-color: #4caf50;
  color: white;
}

.difficulty-tag.‰∏≠Á≠â {
  background-color: #ff9800;
  color: white;
}

.difficulty-tag.Âõ∞Èöæ {
  background-color: #f44336;
  color: white;
}

.problem-tags {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tag {
  background-color: #2d2d3f;
  color: #a6accd;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

/* ÂàÜÈ°µÊéß‰ª∂Ê†∑Âºè */
.pagination {
  margin-top: 24px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
}

.page-button {
  background-color: #2d2d3f;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.page-button:hover:not(:disabled) {
  background-color: #3d3d4f;
}

.page-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.page-info {
  color: #a6accd;
}

/* Âè≥‰æßÂàÜÁ±ªÊ†èÊ†∑Âºè */
.categories {
  flex: 1;
  background-color: #1e1e2e;
  border-radius: 16px;
  padding: 24px;
  height: fit-content;
}

.categories h3 {
  font-size: 20px;
  margin-bottom: 16px;
  color: #fff;
}

/* Ê†áÁ≠æÊêúÁ¥¢Ê°ÜÊ†∑Âºè */
.category-search {
  margin-bottom: 16px;
}

.category-search-input {
  width: 100%;
  padding: 8px 12px;
  background-color: #2d2d3f;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  color: white;
  font-size: 14px;
  transition: all 0.3s ease;
}

.category-search-input:focus {
  outline: none;
  border-color: #4ecdc4;
  box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
}

.category-search-input::placeholder {
  color: #a6accd;
}

/* Ê†áÁ≠æÂàÜÈ°µÊ†∑Âºè */
.tag-pagination {
  margin-top: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
}

.tag-pagination .page-button {
  width: 32px;
  height: 32px;
  background-color: #2d2d3f;
  border: none;
  border-radius: 6px;
  color: #a6accd;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.tag-pagination .page-button:hover:not(:disabled) {
  background-color: #3d3d4f;
  color: white;
}

.tag-pagination .page-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.tag-pagination .page-info {
  color: #a6accd;
  font-size: 14px;
}

.tag-pagination .arrow-icon {
  width: 16px;
  height: 16px;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 1200px) {
  .main-content {
    flex-direction: column;
  }

  .categories {
    order: -1;
  }

  .tag-list {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 12px;
  }

  .category-tag {
    width: calc(50% - 6px);
    padding: 12px 16px;
    user-select: none;
  }
}

@media (max-width: 768px) {
  .content {
    padding: 20px;
  }

  .search-controls {
    flex-direction: column;
  }

  .problem-card {
    flex-direction: column;
  }

  .problem-number {
    text-align: left;
  }
}

/* Ê∑ªÂä†ÁÆ≠Â§¥ÂõæÊ†áÊ†∑Âºè */
.arrow-icon {
  width: 24px;
  height: 24px;
  color: #a6accd;
}

.page-button:hover:not(:disabled) .arrow-icon {
  color: #fff;
}

.page-button:disabled .arrow-icon {
  color: rgba(166, 172, 205, 0.5);
}

.status-tag {
  font-size: 12px;
  padding: 3px 8px;
  border-radius: 4px;
  margin-left: 8px;
  display: inline-block;
  font-weight: 500;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.status-tag.accepted {
  background-color: #4ecdc4;
  color: white;
}

.tag-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.category-tag {
  width: 100%;
  background-color: #2d2d3f;
  color: #a6accd;
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 16px 20px;
  border-radius: 12px;
  text-align: left;
  cursor: default;
  transition: all 0.3s ease;
  font-size: 15px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  user-select: none !important;
}

.category-tag:hover {
  background-color: rgba(78, 205, 196, 0.1);
  border-color: #4ecdc4;
  transform: translateX(8px);
  color: #fff;
}

.category-tag.active {
  background-color: #4ecdc4;
  color: white;
  border-color: #4ecdc4;
  position: relative;
}

.category-tag.active::after {
  content: "‚úì";
  margin-left: 8px;
  font-weight: bold;
}

/* ÈáçÊñ∞ËÆæËÆ°ÁöÑ‰∏ãÊãâÊ°ÜÊ†∑Âºè */
:deep(.el-select) {
  --el-select-border-color-hover: #4ecdc4;
  --el-fill-color-blank: #1e1e2d;
  --el-border-color: rgba(255, 255, 255, 0.1);
  --el-text-color-regular: #fff;
}

:deep(.el-input__wrapper) {
  background-color: #1e1e2d !important;
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
  border-radius: 6px;
  padding: 0 8px;
}

:deep(.el-input__wrapper:hover) {
  box-shadow: 0 0 0 1px #4ecdc4 !important;
}

:deep(.el-input__wrapper.is-focus) {
  box-shadow: 0 0 0 1px #4ecdc4 !important;
}

:deep(.el-input__inner) {
  color: #fff !important;
  height: 35px;
  line-height: 35px;
  font-size: 14px;
}

:deep(.el-input__inner::placeholder) {
  color: #a6accd !important;
}

:deep(.el-select__caret) {
  color: #a6accd;
}

:global(.dark-select) {
  background-color: #1e1e2d !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 6px !important;
}

:global(.dark-select .el-select-dropdown__item) {
  color: #a6accd !important;
  height: 35px;
  line-height: 35px;
  padding: 0 12px;
}

:global(.dark-select .el-select-dropdown__item:hover) {
  background-color: #282836 !important;
  color: #4ecdc4 !important;
}

:global(.dark-select .el-select-dropdown__item.selected) {
  background-color: #282836 !important;
  color: #4ecdc4 !important;
  font-weight: 500;
}

:global(.dark-select .el-popper__arrow::before) {
  background-color: #1e1e2d !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

:global(.dark-select .el-select-dropdown__wrap) {
  background-color: #1e1e2d !important;
}

:global(.el-select__popper.el-popper) {
  background: #1e1e2d !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
}

/* ÁßªÈô§ÊóßÁöÑPrimeVueÁõ∏ÂÖ≥Ê†∑Âºè */
:deep(.p-dropdown),
:deep(.p-dropdown-panel),
:deep(.p-dropdown-items),
:deep(.p-dropdown-item) {
  display: none;
}

.status-select {
    background-color: #333; /* Ê∑±Ëâ≤ËÉåÊôØ */
    color: #fff; /* ÁôΩËâ≤Â≠ó‰Ωì */
}

.status-select .el-select-dropdown {
    background-color: #444; /* Ê∑±Ëâ≤‰∏ãÊãâËèúÂçïËÉåÊôØ */
    color: #fff; /* ÁôΩËâ≤Â≠ó‰Ωì */
}

.status-select .el-option {
    color: #fff; /* ÁôΩËâ≤Â≠ó‰Ωì */
}

.status-select .el-option:hover {
    background-color: #555; /* ÊÇ¨ÂÅúÊó∂ÁöÑÊ∑±Ëâ≤ËÉåÊôØ */
}

/* Êñ∞Â¢ûÂàÜÁ±ªÂç°ÁâáÊ†∑Âºè */
.category-cards {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.parent-category-card {
  background-color: #1e1e2e;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: pointer;
  user-select: none !important;
}

.parent-category-card:hover {
  transform: translateY(-2px);
  border-color: #4ecdc4;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.parent-category-card.active {
  border-color: #4ecdc4;
  background-color: #252536;
}

.category-header {
  display: flex;
  align-items: center;
  padding: 16px;
  gap: 12px;
}

.category-icon {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.category-icon.emoji {
  font-size: 20px;
  background-color: rgba(78, 205, 196, 0.1);
  border-radius: 50%;
  width: 32px;
  height: 32px;
}

.category-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.category-title {
  flex: 1;
  font-size: 16px;
  font-weight: 500;
  color: #fff;
  user-select: none;
}

.category-arrow {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #a6accd;
  transition: transform 0.3s ease;
}

.category-arrow.expanded {
  transform: rotate(180deg);
  color: #4ecdc4;
}

.sub-categories {
  background-color: #252536;
  padding: 0;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.sub-categories.expanded {
  padding: 8px 16px 16px;
  max-height: 500px; /* Ë∞ÉÊï¥‰∏∫ÂêàÈÄÇÁöÑÈ´òÂ∫¶ */
}

.sub-category-card {
  padding: 12px 16px;
  margin: 8px 0;
  background-color: #2d2d3f;
  border-radius: 8px;
  color: #a6accd;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
}

.sub-category-card:hover {
  background-color: rgba(78, 205, 196, 0.1);
  color: #fff;
  transform: translateX(5px);
}

.sub-category-card.active {
  background-color: #4ecdc4;
  color: white;
}

.check-icon {
  font-weight: bold;
}

/* Âä†ËΩΩÁä∂ÊÄÅÊ†∑Âºè */
.category-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 0;
  gap: 16px;
  color: #a6accd;
}

.loading-spinner {
  width: 32px;
  height: 32px;
  border: 3px solid rgba(78, 205, 196, 0.2);
  border-top-color: #4ecdc4;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
@media (max-width: 1200px) {
  .sub-categories.expanded {
    max-height: 300px;
  }

  .sub-category-card {
    padding: 10px 12px;
    margin: 6px 0;
  }
}

@media (max-width: 768px) {
  .parent-category-card {
    margin-bottom: 10px;
  }

  .category-header {
    padding: 12px;
  }

  .sub-categories.expanded {
    padding: 6px 12px 12px;
  }
}

.code-keyword {
  color: #ff79c6;
}

.code-string {
  color: #f1fa8c;
}

.code-function {
  color: #50fa7b;
}

.code-number {
  color: #bd93f9;
}

.code-comment {
  color: #6272a4;
}
</style>
