# 基于当前数据库结构的可视化方案

根据当前数据库表结构的分析，目前可以实现以下数据可视化图表：

## 一、学生做题情况分析图表

### 1. 题目完成情况饼图
- **数据来源**: `submissions`表和`user_problem_status`表
- **图表类型**: 饼图
- **分析维度**: 已完成、未完成、尝试中的题目比例
- **实现方法**: 查询用户的提交记录，按状态统计数量

```sql
SELECT 
    status, 
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM submissions WHERE user_id = 1), 2) as percentage
FROM submissions 
WHERE user_id = 1
GROUP BY status;
```

### 2. 提交错误类型分析饼图
- **数据来源**: `submissions`表
- **图表类型**: 饼图
- **分析维度**: 不同错误类型的分布
- **实现方法**: 统计非Accepted状态的提交，按错误类型分类

```sql
SELECT 
    status, 
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM submissions WHERE user_id = 1 AND status != 'Accepted'), 2) as percentage
FROM submissions 
WHERE user_id = 1 AND status != 'Accepted'
GROUP BY status;
```

### 3. 题目难度分布柱状图
- **数据来源**: `problems`表和`user_problem_status`表
- **图表类型**: 分组柱状图
- **分析维度**: 不同难度题目的完成情况
- **实现方法**: 按难度分组，统计已完成和未完成的题目数量

```sql
SELECT 
    p.difficulty,
    COUNT(DISTINCT p.id) as total_problems,
    COUNT(DISTINCT CASE WHEN ups.status = 'Accepted' THEN p.id END) as solved_problems
FROM 
    problems p
LEFT JOIN 
    user_problem_status ups ON p.id = ups.problem_id AND ups.user_id = 1
GROUP BY 
    p.difficulty;
```

## 二、知识点掌握情况分析图表

### 1. 知识点分类雷达图
- **数据来源**: `problems`表、`problem_categories`表、`problem_category_relations`表和`user_problem_status`表
- **图表类型**: 雷达图
- **分析维度**: 不同知识点分类的掌握程度
- **实现方法**: 统计各分类题目的完成率

```sql
SELECT 
    pc.name as category_name,
    COUNT(DISTINCT p.id) as total_problems,
    COUNT(DISTINCT CASE WHEN ups.status = 'Accepted' THEN p.id END) as solved_problems,
    ROUND(
        COUNT(DISTINCT CASE WHEN ups.status = 'Accepted' THEN p.id END) * 100.0 / 
        NULLIF(COUNT(DISTINCT p.id), 0), 
        2
    ) as completion_rate
FROM 
    problem_categories pc
LEFT JOIN 
    problem_category_relations pcr ON pc.id = pcr.category_id
LEFT JOIN 
    problems p ON pcr.problem_id = p.id
LEFT JOIN 
    user_problem_status ups ON p.id = ups.problem_id AND ups.user_id = 1
WHERE 
    pc.level = 2
GROUP BY 
    pc.id, pc.name
ORDER BY 
    pc.name;
```

### 2. 知识点掌握热力图
- **数据来源**: `problem_categories`表和提交数据
- **图表类型**: 热力图
- **分析维度**: 不同知识点的掌握强度
- **实现方法**: 基于每个分类的题目数量和完成率生成热力图数据

```sql
SELECT 
    pc1.name as parent_category,
    pc2.name as sub_category,
    COUNT(DISTINCT p.id) as problem_count,
    COUNT(DISTINCT CASE WHEN ups.status = 'Accepted' THEN p.id END) as solved_count,
    ROUND(
        COUNT(DISTINCT CASE WHEN ups.status = 'Accepted' THEN p.id END) * 100.0 / 
        NULLIF(COUNT(DISTINCT p.id), 0), 
        2
    ) as mastery_level
FROM 
    problem_categories pc1
JOIN 
    problem_categories pc2 ON pc2.parent_id = pc1.id
LEFT JOIN 
    problem_category_relations pcr ON pc2.id = pcr.category_id
LEFT JOIN 
    problems p ON pcr.problem_id = p.id
LEFT JOIN 
    user_problem_status ups ON p.id = ups.problem_id AND ups.user_id = 1
WHERE 
    pc1.level = 1 AND pc2.level = 2
GROUP BY 
    pc1.id, pc1.name, pc2.id, pc2.name
ORDER BY 
    pc1.name, pc2.name;
```

## 三、提交与学习时间分析图表

### 1. 每日提交数量折线图
- **数据来源**: `submissions`表
- **图表类型**: 折线图
- **分析维度**: 随时间变化的提交数量
- **实现方法**: 按日期统计提交次数

```sql
SELECT 
    DATE(created_at) as submission_date,
    COUNT(*) as submission_count
FROM 
    submissions
WHERE 
    user_id = 1
GROUP BY 
    DATE(created_at)
ORDER BY 
    submission_date;
```

### 2. 提交时间分布热力图
- **数据来源**: `submissions`表
- **图表类型**: 热力图
- **分析维度**: 一周内不同时间的提交活跃度
- **实现方法**: 按星期几和小时统计提交次数

```sql
SELECT 
    DAYNAME(created_at) as day_of_week,
    HOUR(created_at) as hour_of_day,
    COUNT(*) as submission_count
FROM 
    submissions
WHERE 
    user_id = 1
GROUP BY 
    DAYNAME(created_at), HOUR(created_at)
ORDER BY 
    DAYOFWEEK(MIN(created_at)), hour_of_day;
```

### 3. 解题用时箱线图
- **数据来源**: `submissions`表
- **图表类型**: 箱线图
- **分析维度**: 不同难度题目的解题时间分布
- **实现方法**: 计算每个题目从第一次提交到解决的时间

```sql
SELECT 
    p.difficulty,
    p.id as problem_id,
    p.title,
    TIMESTAMPDIFF(MINUTE, 
        MIN(s1.created_at), 
        MIN(CASE WHEN s2.status = 'Accepted' THEN s2.created_at ELSE NULL END)
    ) as solving_time_minutes
FROM 
    submissions s1
LEFT JOIN 
    submissions s2 ON s1.problem_id = s2.problem_id AND s1.user_id = s2.user_id 
    AND s2.status = 'Accepted'
JOIN 
    problems p ON s1.problem_id = p.id
WHERE 
    s1.user_id = 1
GROUP BY 
    p.id, p.difficulty, p.title
HAVING 
    MIN(CASE WHEN s2.status = 'Accepted' THEN s2.created_at ELSE NULL END) IS NOT NULL
ORDER BY 
    p.difficulty, solving_time_minutes;
```

## 四、班级统计图表

### 1. 班级题目完成率对比图
- **数据来源**: `classes`表、`student_info`表和`user_problem_status`表
- **图表类型**: 柱状图
- **分析维度**: 不同班级的整体题目完成率
- **实现方法**: 按班级统计学生的题目完成情况

```sql
SELECT 
    c.class_name,
    COUNT(DISTINCT si.user_id) as student_count,
    COUNT(DISTINCT ups.problem_id) as solved_problems,
    COUNT(DISTINCT p.id) as total_problems,
    ROUND(
        COUNT(DISTINCT ups.problem_id) * 100.0 / 
        NULLIF(COUNT(DISTINCT p.id) * COUNT(DISTINCT si.user_id), 0), 
        2
    ) as completion_rate
FROM 
    classes c
LEFT JOIN 
    student_info si ON c.id = si.class_id
LEFT JOIN 
    user_problem_status ups ON si.user_id = ups.user_id AND ups.status = 'Accepted'
CROSS JOIN 
    problems p
GROUP BY 
    c.id, c.class_name
ORDER BY 
    completion_rate DESC;
```

### 2. 班级每日活跃度折线图
- **数据来源**: `submissions`表、`student_info`表和`classes`表
- **图表类型**: 折线图
- **分析维度**: 班级随时间的活跃程度
- **实现方法**: 按日期统计各班级的提交次数

```sql
SELECT 
    c.class_name,
    DATE(s.created_at) as activity_date,
    COUNT(*) as activity_count
FROM 
    submissions s
JOIN 
    student_info si ON s.user_id = si.user_id
JOIN 
    classes c ON si.class_id = c.id
GROUP BY 
    c.id, c.class_name, DATE(s.created_at)
ORDER BY 
    activity_date, c.class_name;
```

## 五、题目分析图表

### 1. 题目难度分布直方图
- **数据来源**: `problems`表
- **图表类型**: 直方图
- **分析维度**: 题目难度分布
- **实现方法**: 统计各难度级别的题目数量

```sql
SELECT 
    difficulty, 
    COUNT(*) as problem_count
FROM 
    problems
GROUP BY 
    difficulty
ORDER BY 
    FIELD(difficulty, '简单', '中等', '困难');
```

### 2. 题目分类树状图
- **数据来源**: `problem_categories`表和`problem_category_relations`表
- **图表类型**: 树状图
- **分析维度**: 题目分类层级结构
- **实现方法**: 构建分类之间的层级关系

```sql
SELECT 
    pc1.id as parent_id,
    pc1.name as parent_name,
    pc2.id as child_id,
    pc2.name as child_name,
    COUNT(DISTINCT pcr.problem_id) as problem_count
FROM 
    problem_categories pc1
LEFT JOIN 
    problem_categories pc2 ON pc2.parent_id = pc1.id
LEFT JOIN 
    problem_category_relations pcr ON pc2.id = pcr.category_id
WHERE 
    pc1.level = 1
GROUP BY 
    pc1.id, pc1.name, pc2.id, pc2.name
ORDER BY 
    pc1.name, pc2.name;
```

### 3. 题目完成率排行图
- **数据来源**: `problems`表和`submissions`表
- **图表类型**: 条形图
- **分析维度**: 各题目的完成率
- **实现方法**: 计算每道题目的提交次数和成功次数

```sql
SELECT 
    p.problem_number,
    p.title,
    p.difficulty,
    COUNT(DISTINCT s.id) as submission_count,
    COUNT(DISTINCT CASE WHEN s.status = 'Accepted' THEN s.id END) as accepted_count,
    ROUND(
        COUNT(DISTINCT CASE WHEN s.status = 'Accepted' THEN s.id END) * 100.0 / 
        NULLIF(COUNT(DISTINCT s.id), 0), 
        2
    ) as acceptance_rate
FROM 
    problems p
LEFT JOIN 
    submissions s ON p.id = s.problem_id
GROUP BY 
    p.id, p.problem_number, p.title, p.difficulty
ORDER BY 
    acceptance_rate DESC;
```

## 实现建议

以上图表可以通过如下技术栈实现：

1. **前端图表库**：
   - ECharts - 功能全面，支持上述所有图表类型
   - Chart.js - 轻量级，适合简单图表

2. **后端数据处理**：
   - 创建API端点，执行上述SQL查询
   - 对数据进行适当格式化，以满足前端图表库的需求

3. **实现步骤**：
   1. 先实现简单的饼图、柱状图等基础图表
   2. 然后实现雷达图、热力图等复杂图表
   3. 最后整合为完整的数据分析看板

由于当前数据量相对较小（31个问题，81个提交，2个学生），这些图表足以覆盖现有数据的可视化需求。随着系统使用时间增长和数据量增加，可以考虑实现更复杂的分析。 