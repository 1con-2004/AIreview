# 学习路径刷新死锁问题修复记录

1. [ ✅ ] 发现个人中心页面刷新学习路径功能出现500错误，后端日志提示死锁(`ER_LOCK_DEADLOCK`)

2. { 2023.05.11 } 分析问题原因：
    - 个人中心页面的刷新学习路径功能同时并行发起三个请求：弱点分析、学习方向和题目推荐
    - 这些请求会同时操作相关数据表，尝试获取和释放同一资源的锁，导致数据库死锁
    - 后端weakness接口未使用事务处理，而directions和recommend接口使用了事务处理，增加了死锁风险

3. [ ✅ ] 解决方案：
    - 前端修改：将PersonalCenter.vue中的并行请求改为串行请求，按弱点分析→学习方向→题目推荐的顺序依次请求
    - 后端修改：为weakness接口添加事务处理，使用与其他接口一致的事务处理方式
    - 通过这两处修改，避免了多个并发请求同时获取数据库锁导致的死锁问题

4. 主要修改文件：
    - `frontend/src/views/personal/PersonalCenter.vue`
    - `backend/src/api/learning-path/index.js`

5. 修复前后端行为差异：
    - 修复前：三个请求同时发起，导致数据库死锁，刷新功能失败，前端显示错误信息
    - 修复后：三个请求依次发起，各自完成后再发起下一个，避免死锁，刷新功能正常工作

6. 额外收获：
    - 加深了对MySQL事务和死锁处理的理解
    - 在设计并发操作时，需要考虑资源竞争问题，尤其是涉及数据库操作时
    - 对于可能导致数据库锁竞争的操作，应优先考虑串行处理，或使用正确的事务隔离级别 