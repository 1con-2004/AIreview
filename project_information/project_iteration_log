# 项目迭代日志

{ 2025.4.17 } 改动: 修复用户删除功能的外键约束问题

主要改动文件:

1. - backend
    |- src
      |- api
        |- user
          |- index.js
            |- description: 用户API相关文件，修复了删除用户时的外键约束问题。

主要改动逻辑:

- 在删除用户前，先处理该用户在各个表中的外键引用关系
- 对于关键业务数据（如社区、课堂等），将用户引用更新为管理员ID(1)
- 对于用户个人数据（如提交记录、点赞等），直接删除相关记录
- 所有操作在事务中执行，确保数据一致性

问题出现原因:

- 数据库设计时，多个表通过外键约束引用了users表的id字段
- 删除用户时，由于这些外键约束的存在，MySQL阻止删除被引用的用户记录
- 原始代码未处理这些外键关系，导致删除操作失败

解决问题使用的简要方案:

- 识别所有引用users表的外键约束
- 对不同类型的数据采用不同策略：关键业务数据转移所有权，用户个人数据直接删除
- 使用事务确保所有操作的原子性，任何步骤失败都会回滚整个操作

{ 2025.4.18 } 改动: 新增测试用户账户和班级数据

主要改动文件:

1. - backend
    |- public
      |- uploads
        |- avatars
          |- description: 新增20个用户头像文件，命名格式符合系统规范。

2. - docs
    |- accounts.md
      |- description: 记录新增的20个测试账户信息，包括用户名、密码、权限等详细资料。

主要改动逻辑:

- 在数据库中创建10个不同专业的班级
- 新增20个不同权限的用户账户：2个管理员、5个教师、3个超级VIP、10个普通用户
- 为每个用户生成随机头像并保存到系统中
- 为每个用户创建详细的个人资料和学生信息，分配到不同班级和专业
- 将所有账户信息记录到accounts.md文件中，便于测试和演示

问题出现原因:

- 系统需要更多测试用户数据，以便测试不同权限的功能和数据展示效果
- 需要多个班级数据用于测试班级管理和数据统计功能

解决问题使用的简要方案:

- 使用系统现有的密码加密机制创建账户，确保所有用户密码一致便于测试
- 利用公开API获取随机头像，避免版权问题
- 模拟真实学校的班级和专业命名规则，创建有意义的测试数据
- 完整记录所有添加的数据，便于后续参考和使用

